<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Language Mode</title>

  <script src="stories.js"></script>
  <script src="stories_it.js"></script>
  <script src="stories_ru.js"></script>
  <script src="stories_ja.js"></script>
  <script src="stories_ar.js"></script>

  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      color: #333;
    }
    #streak {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    #lives {
      position: fixed;
      top: 1rem;
      right: 2rem;
      font-size: 1.5rem;
      color: red;
    }
    #story, #dialogue, #question-box {
      margin-top: 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
    }
    .accent-buttons {
      margin-top: 1rem;
    }
    .accent-buttons button {
      margin: 0.2rem;
      font-size: 1rem;
      padding: 0.3rem 0.5rem;
    }
    .correct {
      background-color: #d4edda;
    }
    .incorrect {
      background-color: #f8d7da;
      animation: shake 0.3s;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
    }
  </style>
</head>
<body>
  <audio id="sound-correct" src="correct.mp3" preload="auto"></audio>
  <audio id="sound-wrong" src="wrong.mp3" preload="auto"></audio>

  <div style="margin-bottom: 1rem;">
    <button onclick="switchLanguage('fr')">Fran√ßais</button>
    <button onclick="switchLanguage('it')">Italiano</button>
    <button onclick="switchLanguage('ru')">–†—É—Å—Å–∫–∏–π</button>
    <button onclick="switchLanguage('ja')">Êó•Êú¨Ë™û</button>
    <button onclick="switchLanguage('ar')">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
  </div>

  <h1>Language Mode</h1>
  <div id="streak">üî• Streak: 0</div>
  <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>

  <div id="story">
    <h3>üìñ <span id="story-title">Extrait de roman</span></h3>
    <p id="story-text" style="display: inline;">Cliquez ici pour lire un passage.</p>
    <button onclick="speakText('story')" style="margin-left: 0.5em; font-size: 1.2em;">üîä</button>
    <br><br>
    <button onclick="loadStory()" id="switch-text-button">Changer le texte</button>
  </div>

  <div id="dialogue">
    <h3>üó£Ô∏è Question</h3>
    <p id="question" style="display: inline;">Click a story to get a question.</p>
    <button onclick="speakText('question')" style="margin-left: 0.5em;">üîä</button>
  </div>

  <div id="question-box">
    <p id="correct-answer-display" style="font-weight: bold; color: green;"></p>
    <label for="user-answer">Your answer:</label><br>
    <textarea id="user-answer" rows="3" cols="40"></textarea>
    <div class="accent-buttons"></div>
    <br>
    <button onclick="submitAnswer()">Submit</button>
    <p id="response-confirmation"></p>
  </div>

  <script>
    let currentLanguage = 'fr';
    let currentAnswer = '';
    let lives = 3;
    let questionCount = 0;
    let wrongAttempts = 0;

    const translations = {
      fr: { storyButton: "Changer le texte", louis: "Louis demande", answerWas: "‚úÖ La bonne r√©ponse √©tait :" },
      it: { storyButton: "Cambia il testo", louis: "Luigi chiede", answerWas: "‚úÖ La risposta corretta era:" },
      ru: { storyButton: "–°–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç", louis: "–í–æ–ø—Ä–æ—Å", answerWas: "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –±—ã–ª:" },
      ja: { storyButton: "„ÉÜ„Ç≠„Çπ„Éà„ÇíÂ§âÊõ¥", louis: "„É´„Ç§„ÅÆË≥™Âïè", answerWas: "‚úÖ Ê≠£Ëß£„ÅØÔºö" },
      ar: { storyButton: "ÿ∫ŸäŸëÿ± ÿßŸÑŸÜÿµ", louis: "ŸÑŸàŸäÿ≥ Ÿäÿ≥ÿ£ŸÑ", answerWas: "‚úÖ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÉÿßŸÜÿ™:" }
    };

    const accents = {
      fr: ['√†','√¢','√ß','√©','√®','√™','√´','√Æ','√Ø','√¥','√π','√ª','√º','√ø'],
      it: ['√†','√®','√©','√¨','√≠','√Æ','√≤','√≥','√π','√∫'],
      ru: ['–∞','–±','–≤','–≥','–¥','–µ','—ë','–∂','–∑','–∏'],
      ja: ['„ÅÇ','„ÅÑ','„ÅÜ','„Åà','„Åä','„Åã','„Åç','„Åè','„Åë','„Åì'],
      ar: ['ÿß','ÿ®','ÿ™','ÿ´','ÿ¨','ÿ≠','ÿÆ','ÿØ','ÿ∞','ÿ±']
    };

    const storySources = {
      fr: () => stories,
      it: () => stories_it,
      ru: () => stories_ru,
      ja: () => stories_ja,
      ar: () => stories_ar
    };

    function switchLanguage(lang) {
      currentLanguage = lang;
      const t = translations[lang];
      document.querySelector("#switch-text-button").innerText = t.storyButton;
      document.querySelector("#dialogue h3").innerText = t.louis;
      loadStory();
    }

    function updateLives() {
      document.getElementById('lives').innerText = '‚ù§Ô∏è'.repeat(lives);
    }

    function loadStory() {
      const data = storySources[currentLanguage]();
      if (!data || data.length === 0) return;
      const story = data[Math.floor(Math.random() * data.length)];
      document.getElementById('story-text').innerText = story.text;
      document.getElementById('question').innerText = translations[currentLanguage].louis + " : " + story.question;
      currentAnswer = story.answer.toLowerCase();
      document.getElementById('user-answer').value = '';
      document.getElementById('correct-answer-display').innerText = '';
      document.getElementById('response-confirmation').innerText = '';
      wrongAttempts = 0;
    }

    function submitAnswer() {
      const textarea = document.getElementById('user-answer');
      const userResponse = textarea.value.trim().toLowerCase();
      if (!userResponse) return;

      if (userResponse === currentAnswer) {
        document.getElementById('response-confirmation').innerText = "‚úÖ";
        document.getElementById('sound-correct').play();
        questionCount++;
        setTimeout(loadStory, 1000);
      } else {
        document.getElementById('sound-wrong').play();
        wrongAttempts++;
        lives--;
        updateLives();
        textarea.value = '';

        if (wrongAttempts >= 3) {
          document.getElementById('correct-answer-display').innerText =
            translations[currentLanguage].answerWas + ` "${currentAnswer}"`;
          setTimeout(loadStory, 5000);
        } else {
          document.getElementById('response-confirmation').innerText = "‚ùå";
        }

        if (lives <= 0) {
          alert("Game over. Restarting...");
          lives = 3;
          questionCount = 0;
          updateLives();
          loadStory();
        }
      }
    }

    function speakText(type) {
        let text = '';
        if (type === 'story') {
          text = document.getElementById('story-text').innerText;
        } else if (type === 'question') {
          text = document.getElementById('question').innerText;
        }
      
        const langMap = {
          fr: 'fr-FR', it: 'it-IT', ru: 'ru-RU', ja: 'ja-JP', ar: 'ar-SA'
        };
      
        const lang = langMap[currentLanguage] || 'en-US';
        const voices = window.speechSynthesis.getVoices();
        const voice = voices.find(v => v.lang === lang);
      
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        if (voice) {
          utterance.voice = voice;
        }
      
        speechSynthesis.cancel(); // stop any ongoing speech
        speechSynthesis.speak(utterance);
}

    window.speechSynthesis.onvoiceschanged = () => {
      console.log("Available voices:", speechSynthesis.getVoices());
};


    window.onload = () => {
      switchLanguage('fr');
    };

    document.getElementById("user-answer").addEventListener("keydown", function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        submitAnswer();
      }
    });
  </script>
</body>
</html>
